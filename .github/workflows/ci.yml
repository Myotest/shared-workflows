on:
  pull_request:
  push:

jobs:
  version:
    uses: noveto-com/shared-workflows/.github/workflows/version.yml@76b5848a444c6839d637ec624360a26adf5640f9

  docs:
    needs: version
    uses: noveto-com/shared-workflows/.github/workflows/docs.yml@874dae19b7bcbe5f6a2621b098082f8fa38a300f
    with:
      version: ${{ needs.version.outputs.version }}
      pdf-name: "sharedworkflows.pdf"

  deploy:
    if: github.ref == 'refs/heads/main'
    needs: [version, docs]
    uses: noveto-com/shared-workflows/.github/workflows/deploy-s3.yml@76b5848a444c6839d637ec624360a26adf5640f9
    with:
      version: ${{ needs.version.outputs.version }}
      project: shared-workflows
    secrets:
      AWS_S3_BUCKET: ${{ secrets.AWS_S3_BUCKET }}
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

  release:
    if: github.ref == 'refs/heads/main'
    needs: [version, docs]
    uses: noveto-com/shared-workflows/.github/workflows/deploy-release.yml@feature/upload-release
    with:
      tag: ${{ needs.version.outputs.tag }}
